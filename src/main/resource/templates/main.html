<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="layouts/base">
<head>
<title>メイン画面</title>
</head>
<body>
	<div layout:fragment="content">
		<header>
			<div id="example">
				<h1 th:text="${msg}"></h1>
			</div>
			<nav>
				<ul>
					<li><a href="/userlist">ユーザー一覧</a></li>
					<form action="/logout" method="POST">
						<p>
							<input type="submit" value="ログアウト"></input>
						</p>
					</form>
				</ul>
			</nav>
		</header>

		<form action="/tweets" method="post">
			ツイート：<p><textarea cols="30" rows="3" name="tweet">なんかつぶやきましょう。</textarea>
			</p>
			<p>
				<input type="submit"></input>
			</p>
		</form>

		<div id="app">
			<div>
				<ul>
					<template v-for="tweet in result.list">
					<h2>{{ tweet.userName }}</h2>
					<p>{{ tweet.contents }}</p>
					</template>
				</ul>
			</div>
			<button v-if="result.existsNextPage" v-on:click="nextPage()" value="もっと見る">もっと見る</button>
		</div>
		<script>
			new Vue({
				el : '#app',
				data : {
					result : {
						list : [],
						existsNextPage : true
					}
				},
				created : function() {
					var that = this;
					$.ajax({
						type : "GET",
						url : "/tweets",
						dataType : "json",
						success : function(list) {
							// 成功時の処理としてリスト形式の結果を代入する
							// e.g. [{"title": "hoge", "text": "hogehoge"}, ...]
							that.result.list = list.data;
							that.result.currentPageNumber = list.currentPageNumber;
							that.result.existsNextPage = list.existsNextPage;
						}
					});
				},
				methods : {
					nextPage : function() {
						var that = this;
						$.ajax({
							type : "GET",
							url : "/tweets?p=" + (that.result.currentPageNumber+1),
							dataType : "json",
							success : function(list) {
								for (var index in list.data){
									that.result.list.push(list.data[index]);
								}
								that.result.currentPageNumber = list.currentPageNumber;
								that.result.existsNextPage = list.existsNextPage;
							}
						});
					}
				}
			});
		</script>
	</div>

</body>
</html>